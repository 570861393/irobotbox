#!/usr/bin/python3.6
# -*- coding: utf-8 -*-
# @Time    : 2020/10/27 11:37
# @Author  : cool_chen
# @File    : country_code.py
# @Software: PyCharm
import datetime
from setting import *

today = datetime.date.today()-datetime.timedelta()
yesterday = datetime.date.today()-datetime.timedelta(days=1)
three_days_ago = datetime.date.today()-datetime.timedelta(days=3)
four_days_ago = datetime.date.today()-datetime.timedelta(days=4)
# country_code = {'id': '10000001', 'text': '亚马逊平台', 'state': 'closed', 'children': [{'id': '20000001', 'text': '加拿大', 'state': 'closed', 'children': [{'id': '892', 'text': 'AMZ-ADO-CA', 'OrderSourceID': '892', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '753', 'text': 'AMZ-Bacliz-CA', 'OrderSourceID': '753', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '321', 'text': 'AMZ-Bealen-CA', 'OrderSourceID': '321', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '819', 'text': 'AMZ-Clairaudce-CA', 'OrderSourceID': '819', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '882', 'text': 'AMZ-CLR-CA', 'OrderSourceID': '882', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '307', 'text': 'AMZ-Dreambig-CA', 'OrderSourceID': '307', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '749', 'text': 'AMZ-Eurus-CA', 'OrderSourceID': '749', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '841', 'text': 'AMZ-Excelsun-CA', 'OrderSourceID': '841', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '821', 'text': 'AMZ-Gosowib-CA', 'OrderSourceID': '821', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '885', 'text': 'AMZ-GRJ-CA', 'OrderSourceID': '885', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '835', 'text': 'AMZ-Heimdarr-CA', 'OrderSourceID': '835', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '877', 'text': 'AMZ-HFE-CA', 'OrderSourceID': '877', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '820', 'text': 'AMZ-Hifelice-CA', 'OrderSourceID': '820', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '55', 'text': 'AMZ-HIMALAYA-CA', 'OrderSourceID': '55', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '815', 'text': 'AMZ-InsideOutOut-CA ', 'OrderSourceID': '815', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '319', 'text': 'AMZ-Kri Cloud-CA', 'OrderSourceID': '319', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '462', 'text': 'AMZ-LiHoenix-CA', 'OrderSourceID': '462', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '309', 'text': 'AMZ-Lit Tiafs-CA', 'OrderSourceID': '309', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '880', 'text': 'AMZ-LL-CA', 'OrderSourceID': '880', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '750', 'text': 'AMZ-Mariana-CA', 'OrderSourceID': '750', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '884', 'text': 'AMZ-MTL-CA', 'OrderSourceID': '884', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '539', 'text': 'AMZ-Soar Store-CA', 'OrderSourceID': '539', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '839', 'text': 'AMZ-THUNDERSTORM-CA', 'OrderSourceID': '839', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '761', 'text': 'AMZ-Turtle-CA', 'OrderSourceID': '761', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '913', 'text': 'AMZ-VanRsport-CA', 'OrderSourceID': '913', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '83', 'text': 'AMZ-VANSTORE-CA', 'OrderSourceID': '83', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '90', 'text': 'AMZ-VANTOP-CA', 'OrderSourceID': '90', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '667', 'text': 'AMZ-VIK-CA', 'OrderSourceID': '667', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '817', 'text': 'AMZ-WinWinWinWin-CA', 'OrderSourceID': '817', 'OrderSourceCountry': 'CA', 'chilren': []}, {'id': '804', 'text': 'AMZ-XLENS-CA', 'OrderSourceID': '804', 'OrderSourceCountry': 'CA', 'chilren': []}]}, {'id': '41000001', 'text': '德国', 'state': 'closed', 'children': [{'id': '734', 'text': 'AMZ-All1n-DE', 'OrderSourceID': '734', 'OrderSourceCountry': 'DE', 'chilren': []}, {'id': '717', 'text': 'AMZ-Dreambig-DE', 'OrderSourceID': '717', 'OrderSourceCountry': 'DE', 'chilren': []}, {'id': '871', 'text': 'AMZ-JXHTradeecm-DE', 'OrderSourceID': '871', 'OrderSourceCountry': 'DE', 'chilren': []}, {'id': '867', 'text': 'AMZ-MyismGDE-DE', 'OrderSourceID': '867', 'OrderSourceCountry': 'DE', 'chilren': []}, {'id': '855', 'text': 'AMZ-Thunderstorm-DE', 'OrderSourceID': '855', 'OrderSourceCountry': 'DE', 'chilren': []}, {'id': '85', 'text': 'AMZ-VANSTORE-DE', 'OrderSourceID': '85', 'OrderSourceCountry': 'DE', 'chilren': []}, {'id': '92', 'text': 'AMZ-VANTOP-DE', 'OrderSourceID': '92', 'OrderSourceCountry': 'DE', 'chilren': []}, {'id': '935', 'text': 'AMZ-VHKSTORE-DE', 'OrderSourceID': '935', 'OrderSourceCountry': 'DE', 'chilren': []}, {'id': '849', 'text': 'AMZ-VIK-DE', 'OrderSourceID': '849', 'OrderSourceCountry': 'DE', 'chilren': []}]}, {'id': '212000001', 'text': '西班牙', 'state': 'closed', 'children': [{'id': '874', 'text': ' AMZ-JXHTradeecm-ES', 'OrderSourceID': '874', 'OrderSourceCountry': 'ES', 'chilren': []}, {'id': '736', 'text': 'AMZ-All1n-ES', 'OrderSourceID': '736', 'OrderSourceCountry': 'ES', 'chilren': []}, {'id': '870', 'text': 'AMZ-MyismGDE-ES', 'OrderSourceID': '870', 'OrderSourceCountry': 'ES', 'chilren': []}, {'id': '857', 'text': 'AMZ-Thunderstorm-ES', 'OrderSourceID': '857', 'OrderSourceCountry': 'ES', 'chilren': []}, {'id': '88', 'text': 'AMZ-VANSTORE-ES', 'OrderSourceID': '88', 'OrderSourceCountry': 'ES', 'chilren': []}, {'id': '95', 'text': 'AMZ-VANTOP-ES', 'OrderSourceID': '95', 'OrderSourceCountry': 'ES', 'chilren': []}, {'id': '936', 'text': 'AMZ-VHKSTORE-ES', 'OrderSourceID': '936', 'OrderSourceCountry': 'ES', 'chilren': []}, {'id': '851', 'text': 'AMZ-VIK-ES', 'OrderSourceID': '851', 'OrderSourceCountry': 'ES', 'chilren': []}]}, {'id': '38000001', 'text': '法国', 'state': 'closed', 'children': [{'id': '733', 'text': 'AMZ-All1n-FR', 'OrderSourceID': '733', 'OrderSourceCountry': 'FR', 'chilren': []}, {'id': '872', 'text': 'AMZ-JXHTradeecm-FR', 'OrderSourceID': '872', 'OrderSourceCountry': 'FR', 'chilren': []}, {'id': '868', 'text': 'AMZ-MyismGDE-FR', 'OrderSourceID': '868', 'OrderSourceCountry': 'FR', 'chilren': []}, {'id': '854', 'text': 'AMZ-Thunderstorm-FR', 'OrderSourceID': '854', 'OrderSourceCountry': 'FR', 'chilren': []}, {'id': '86', 'text': 'AMZ-VANSTORE-FR', 'OrderSourceID': '86', 'OrderSourceCountry': 'FR', 'chilren': []}, {'id': '93', 'text': 'AMZ-VANTOP-FR', 'OrderSourceID': '93', 'OrderSourceCountry': 'FR', 'chilren': []}, {'id': '934', 'text': 'AMZ-VHKSTORE-FR', 'OrderSourceID': '934', 'OrderSourceCountry': 'FR', 'chilren': []}, {'id': '847', 'text': 'AMZ-VIK-FR', 'OrderSourceID': '847', 'OrderSourceCountry': 'FR', 'chilren': []}]}, {'id': '112000001', 'text': '英国', 'state': 'closed', 'children': [{'id': '737', 'text': 'AMZ-All1n-UK', 'OrderSourceID': '737', 'OrderSourceCountry': 'GB', 'chilren': []}, {'id': '853', 'text': 'AMZ-Thunderstorm-UK', 'OrderSourceID': '853', 'OrderSourceCountry': 'GB', 'chilren': []}, {'id': '84', 'text': 'AMZ-VANSTORE-UK', 'OrderSourceID': '84', 'OrderSourceCountry': 'GB', 'chilren': []}, {'id': '91', 'text': 'AMZ-VANTOP-UK', 'OrderSourceID': '91', 'OrderSourceCountry': 'GB', 'chilren': []}, {'id': '970', 'text': 'AMZ-VHKSTORE-UK', 'OrderSourceID': '970', 'OrderSourceCountry': 'GB', 'chilren': []}, {'id': '848', 'text': 'AMZ-VIK-UK', 'OrderSourceID': '848', 'OrderSourceCountry': 'GB', 'chilren': []}, {'id': '938', 'text': 'AMZ-XixiGDecom-UK', 'OrderSourceID': '938', 'OrderSourceCountry': 'GB', 'chilren': []}]}, {'id': '53000001', 'text': '意大利', 'state': 'closed', 'children': [{'id': '735', 'text': 'AMZ-All1n-IT', 'OrderSourceID': '735', 'OrderSourceCountry': 'IT', 'chilren': []}, {'id': '873', 'text': 'AMZ-JXHTradeecm-IT', 'OrderSourceID': '873', 'OrderSourceCountry': 'IT', 'chilren': []}, {'id': '869', 'text': 'AMZ-MyismGDE-IT', 'OrderSourceID': '869', 'OrderSourceCountry': 'IT', 'chilren': []}, {'id': '856', 'text': 'AMZ-Thunderstorm-IT', 'OrderSourceID': '856', 'OrderSourceCountry': 'IT', 'chilren': []}, {'id': '87', 'text': 'AMZ-VANSTORE-IT', 'OrderSourceID': '87', 'OrderSourceCountry': 'IT', 'chilren': []}, {'id': '94', 'text': 'AMZ-VANTOP-IT', 'OrderSourceID': '94', 'OrderSourceCountry': 'IT', 'chilren': []}, {'id': '824', 'text': 'AMZ-VHKSTORE-IT', 'OrderSourceID': '824', 'OrderSourceCountry': 'IT', 'chilren': []}, {'id': '850', 'text': 'AMZ-VIK-IT', 'OrderSourceID': '850', 'OrderSourceCountry': 'IT', 'chilren': []}]}, {'id': '54000001', 'text': '日本', 'state': 'closed', 'children': [{'id': '645', 'text': 'AMZ-Dreambig-JP', 'OrderSourceID': '645', 'OrderSourceCountry': 'JP', 'chilren': []}, {'id': '81', 'text': 'AMZ-HIMALAYA-JP', 'OrderSourceID': '81', 'OrderSourceCountry': 'JP', 'chilren': []}, {'id': '658', 'text': 'AMZ-VANSTORE-JP', 'OrderSourceID': '658', 'OrderSourceCountry': 'JP', 'chilren': []}, {'id': '386', 'text': 'AMZ-VANTOP-JP', 'OrderSourceID': '386', 'OrderSourceCountry': 'JP', 'chilren': []}, {'id': '830', 'text': 'AMZ-VIK-JP', 'OrderSourceID': '830', 'OrderSourceCountry': 'JP', 'chilren': []}, {'id': '456', 'text': 'AMZ-XH-JP', 'OrderSourceID': '456', 'OrderSourceCountry': 'JP', 'chilren': []}]}, {'id': '76000001', 'text': '荷兰', 'state': 'closed', 'children': [{'id': '876', 'text': ' AMZ-MyismGDE-NL', 'OrderSourceID': '876', 'OrderSourceCountry': 'NL', 'chilren': []}, {'id': '875', 'text': 'AMZ-JXHTradeecm-NL', 'OrderSourceID': '875', 'OrderSourceCountry': 'NL', 'chilren': []}, {'id': '858', 'text': 'AMZ-Thunderstorm-NL', 'OrderSourceID': '858', 'OrderSourceCountry': 'NL', 'chilren': []}, {'id': '743', 'text': 'AMZ-VANSTORE-NL', 'OrderSourceID': '743', 'OrderSourceCountry': 'NL', 'chilren': []}, {'id': '937', 'text': 'AMZ-VHKSTORE-NL', 'OrderSourceID': '937', 'OrderSourceCountry': 'NL', 'chilren': []}, {'id': '852', 'text': 'AMZ-VIK-NL', 'OrderSourceID': '852', 'OrderSourceCountry': 'NL', 'chilren': []}]}, {'id': '226000001', 'text': '美国', 'state': 'closed', 'children': [{'id': '891', 'text': 'AMZ-ADO-US', 'OrderSourceID': '891', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '976', 'text': 'AMZ-AIOLOS-US', 'OrderSourceID': '976', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '754', 'text': 'AMZ-Bacliz-US ', 'OrderSourceID': '754', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '320', 'text': 'AMZ-Bealen-US', 'OrderSourceID': '320', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '807', 'text': 'AMZ-Chering-US', 'OrderSourceID': '807', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '818', 'text': 'AMZ-Clairaudce-US', 'OrderSourceID': '818', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '881', 'text': 'AMZ-CLR-US', 'OrderSourceID': '881', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '942', 'text': 'AMZ-CYSNETWORK-US', 'OrderSourceID': '942', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '825', 'text': 'AMZ-Cystereo Direct-US', 'OrderSourceID': '825', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '306', 'text': 'AMZ-Dreambig-US', 'OrderSourceID': '306', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '740', 'text': 'AMZ-Eurus-US', 'OrderSourceID': '740', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '840', 'text': 'AMZ-Excelsun-US', 'OrderSourceID': '840', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '826', 'text': 'AMZ-Gallant-US', 'OrderSourceID': '826', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '742', 'text': 'AMZ-Gosowib-US', 'OrderSourceID': '742', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '878', 'text': 'AMZ-GRJ-US', 'OrderSourceID': '878', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '834', 'text': 'AMZ-Heimdarr-US', 'OrderSourceID': '834', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '837', 'text': 'AMZ-HFE-US', 'OrderSourceID': '837', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '768', 'text': 'AMZ-Hifelice-US', 'OrderSourceID': '768', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '54', 'text': 'AMZ-HIMALAYA-US', 'OrderSourceID': '54', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '814', 'text': 'AMZ-InsideOutOut-US', 'OrderSourceID': '814', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '310', 'text': 'AMZ-Kri Cloud-US', 'OrderSourceID': '310', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '971', 'text': 'AMZ-Lesnetwork-US', 'OrderSourceID': '971', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '461', 'text': 'AMZ-LiHoenix-US', 'OrderSourceID': '461', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '308', 'text': 'AMZ-Lit Tiafs-US', 'OrderSourceID': '308', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '879', 'text': 'AMZ-LL-US', 'OrderSourceID': '879', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '739', 'text': 'AMZ-Mariana-US', 'OrderSourceID': '739', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '883', 'text': 'AMZ-MTL-US', 'OrderSourceID': '883', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '951', 'text': 'AMZ-NgTop-CA', 'OrderSourceID': '951', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '952', 'text': 'AMZ-NgTop-US', 'OrderSourceID': '952', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '956', 'text': 'AMZ-ONEKline-US', 'OrderSourceID': '956', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '965', 'text': 'AMZ-OverDrive-US', 'OrderSourceID': '965', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '977', 'text': 'AMZ-Projector Outlet-CA', 'OrderSourceID': '977', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '888', 'text': 'AMZ-Sagino Direct-US', 'OrderSourceID': '888', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '889', 'text': 'AMZ-SagSnetwork-US', 'OrderSourceID': '889', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '538', 'text': 'AMZ-Soar Store-US', 'OrderSourceID': '538', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '836', 'text': 'AMZ-TESTONE-US', 'OrderSourceID': '836', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '838', 'text': 'AMZ-THUNDERSTORM-US', 'OrderSourceID': '838', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '915', 'text': 'AMZ-Tokmali-US', 'OrderSourceID': '915', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '760', 'text': 'AMZ-Turtle-US', 'OrderSourceID': '760', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '912', 'text': 'AMZ-VanRsport-US', 'OrderSourceID': '912', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '82', 'text': 'AMZ-VANSTORE-US', 'OrderSourceID': '82', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '89', 'text': 'AMZ-VANTOP-US', 'OrderSourceID': '89', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '666', 'text': 'AMZ-VIK-US', 'OrderSourceID': '666', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '944', 'text': 'AMZ-Virmee Direct-US', 'OrderSourceID': '944', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '943', 'text': 'AMZ-VTECH-US', 'OrderSourceID': '943', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '816', 'text': 'AMZ-WinWinWinWin-US', 'OrderSourceID': '816', 'OrderSourceCountry': 'US', 'chilren': []}, {'id': '427', 'text': 'AMZ-XLENS-US', 'OrderSourceID': '427', 'OrderSourceCountry': 'US', 'chilren': []}]}]}
def put_task(country_code):
    country_code = eval(country_code)
    us_uk_jp =[]
    all_country = []
    for country in country_code['children']:
        countryinfo = country['children']
        for countryosid in countryinfo:
            all_country.append(countryosid['OrderSourceID'])
            if countryosid['OrderSourceCountry'] in['JP','GB','US']:
                us_uk_jp.append(countryosid['OrderSourceID'])
    print(len(us_uk_jp),us_uk_jp)
    print(len(all_country),all_country)
    for i in range(0, len(us_uk_jp), 10):
        task_list = us_uk_jp[i: i + 10]
        us_uk_jp_osid = str(task_list).replace('[','').replace(']','').replace("'",'').replace(' ','')
        print(us_uk_jp_osid)
        # ① Flat File All Orders Reportby Last Update  下午2点运行 美英日三个国家
        task1 = "{'action':'SaveAmazonReportTask','begindate':'" + str(three_days_ago) + "','enddate':'" + str(today) + "','osid':'"+us_uk_jp_osid+"','reporttype':'9','typename':'Flat File All Orders Reportby Last Update'}"
        redis_conn.rpush(redis_task,task1)

        # ② FBA Daily Inventory History Report  下午4点运行  美英日三个国家
        task2 = "{'action':'SaveAmazonReportTask','begindate':'" + str(four_days_ago) + "','enddate':'" + str(today) + "','osid':'"+us_uk_jp_osid+"','reporttype':'36','typename':'FBA Daily Inventory History Report'}"
        redis_conn.rpush(redis_task2, task2)

        # ③ FBA Received Inventory Report   下午4点运行 美英日三个国家
        task3 = "{'action':'SaveAmazonReportTask','begindate':'" + str(four_days_ago) + "','enddate':'" + str(today) + "','osid':'"+us_uk_jp_osid+"','reporttype':'24','typename':'FBA Received Inventory Report'}"
        redis_conn.rpush(redis_task2, task3)

    for i in range(0, len(all_country), 10):
        task_list = all_country[i: i + 10]
        all_osid = str(task_list).replace('[', '').replace(']', '').replace("'", '').replace(' ', '')
        # ④ FBA Manage Inventory  下午2点运行 全部国家
        task4 = "{'action':'SaveAmazonReportTask','begindate':'" + str(today) + "','enddate':'" + str(today) + "','osid':'"+all_osid+"','reporttype':'20','typename':'FBA Manage Inventory'}"
        redis_conn.rpush(redis_task, task4)













